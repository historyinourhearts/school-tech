<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–®–ö–û–õ–¢–ï–• - –ß–∞—Ç</title>
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .chat-page { 
            padding: 20px; 
            max-width: 1200px; 
            margin: 0 auto; 
        }
        .back-btn { 
            background: #081B7D; 
            color: white; 
            padding: 12px 24px; 
            border-radius: 10px; 
            text-decoration: none; 
            margin: 20px 0; 
            display: inline-block; 
            font-weight: bold;
        }
        .chat-container { 
            display: flex; 
            height: 75vh; 
            background: white; 
            border-radius: 20px; 
            overflow: hidden; 
            margin-top: 20px;
            border: 2px solid #e2e8f0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .users-side { 
            width: 300px; 
            border-right: 2px solid #e2e8f0; 
            display: flex;
            flex-direction: column;
            background: #f8fafc;
        }
        .users-header {
            padding: 25px;
            border-bottom: 2px solid #e2e8f0;
        }
        .users-header h3 {
            margin: 0;
            color: #1e293b;
            font-size: 22px;
        }
        .users-list { 
            flex: 1; 
            overflow-y: auto;
            padding: 10px;
        }
        .user-item { 
            padding: 15px; 
            cursor: pointer; 
            border-radius: 12px; 
            margin-bottom: 8px;
            border: 1px solid transparent;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .user-item:hover { 
            background: white;
            border-color: #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .user-item.active { 
            background: white;
            border-color: #081B7D;
            box-shadow: 0 2px 12px rgba(8, 27, 125, 0.1);
        }
        .user-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #081B7D, #3b82f6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
            flex-shrink: 0;
        }
        .user-info {
            flex: 1;
            min-width: 0;
        }
        .user-name {
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .user-username {
            color: #64748b;
            font-size: 13px;
        }
        
        /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –æ–∫–Ω–æ —á–∞—Ç–∞ */
        .chat-side { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
        }
        .chat-header { 
            padding: 25px; 
            border-bottom: 2px solid #e2e8f0;
            background: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .chat-avatar {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, #081B7D, #3b82f6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }
        .chat-header-info h3 {
            margin: 0 0 5px 0;
            color: #1e293b;
            font-size: 20px;
        }
        .chat-header-info p {
            margin: 0;
            color: #64748b;
            font-size: 14px;
        }
        
        /* –û–±–ª–∞—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π */
        .messages-area { 
            flex: 1; 
            padding: 25px; 
            overflow-y: auto;
            background: #f8fafc;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏—è - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å –∫–∞–∫ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö */
        .message-wrapper {
            display: flex;
            margin-bottom: 8px;
        }
        
        .message-wrapper.me {
            justify-content: flex-end; /* –ú–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∞ */
        }
        
        .message-wrapper.other {
            justify-content: flex-start; /* –ß—É–∂–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–ª–µ–≤–∞ */
        }
        
        .message-bubble {
            max-width: 65%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
            line-height: 1.4;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        /* –ú–æ–∏ —Å–æ–æ–±—â–µ–Ω–∏—è (—Å–ø—Ä–∞–≤–∞) - —Å–∏–Ω–∏–µ */
        .message-wrapper.me .message-bubble {
            background: #081B7D;
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö (—Å–ª–µ–≤–∞) - —Å–≤–µ—Ç–ª—ã–µ */
        .message-wrapper.other .message-bubble {
            background: white;
            color: #1e293b;
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 4px;
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏/–¥–æ—Å—Ç–∞–≤–∫–∏ */
        .message-status {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
            font-size: 11px;
            opacity: 0.7;
        }
        
        .message-wrapper.me .message-status {
            justify-content: flex-end;
            color: rgba(255,255,255,0.7);
        }
        
        .message-wrapper.other .message-status {
            color: #64748b;
        }
        
        /* –ê–≤–∞—Ç–∞—Ä –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è —Å–ª–µ–≤–∞ –æ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è */
        .sender-avatar {
            width: 32px;
            height: 32px;
            background: #94a3b8;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
            margin-right: 10px;
            align-self: flex-end;
            flex-shrink: 0;
        }
        
        /* –ü–æ–ª–µ –≤–≤–æ–¥–∞ */
        .input-area { 
            padding: 20px; 
            border-top: 2px solid #e2e8f0; 
            display: flex; 
            gap: 12px;
            background: white;
        }
        .message-input { 
            flex: 1; 
            padding: 14px 18px; 
            border: 2px solid #e2e8f0; 
            border-radius: 12px;
            font-size: 15px;
            font-family: 'MONTSERRAT', sans-serif;
            resize: none;
            min-height: 50px;
            max-height: 120px;
        }
        .message-input:focus {
            outline: none;
            border-color: #081B7D;
            box-shadow: 0 0 0 3px rgba(8, 27, 125, 0.1);
        }
        .send-btn { 
            background: #081B7D; 
            color: white; 
            border: none; 
            padding: 14px 28px; 
            border-radius: 12px; 
            cursor: pointer;
            font-weight: bold;
            font-family: 'UNCAGE', sans-serif;
            font-size: 15px;
            transition: all 0.2s;
            align-self: flex-end;
        }
        .send-btn:hover {
            background: #0a24a0;
            transform: translateY(-1px);
        }
        .send-btn:active {
            transform: translateY(0);
        }
        .send-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }
        
        /* –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—É—Å—Ç–æ–≥–æ —á–∞—Ç–∞ */
        .empty-chat-state {
            text-align: center;
            margin-top: 100px;
            color: #64748b;
        }
        .empty-chat-state h3 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #1e293b;
        }
        .empty-chat-state p {
            font-size: 16px;
            max-width: 400px;
            margin: 0 auto;
            line-height: 1.5;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .chat-container {
                flex-direction: column;
                height: 85vh;
            }
            .users-side {
                width: 100%;
                height: 200px;
                border-right: none;
                border-bottom: 2px solid #e2e8f0;
            }
            .message-bubble {
                max-width: 80%;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="logo-section">
            <a href="{{ url_for('home') }}" class="logo-link">
                <div class="logo-text">–®–ö–û–õ–¢–ï–•</div>
            </a>
            <div class="location">–ú–û–°–ö–í–ê</div>
        </div>
        <div class="user-section">
            {% if user and user.role == 'teacher' %}
            <a href="{{ url_for('admin_panel') }}" class="admin-nav-btn" style="margin-right: 15px;">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</a>
            {% endif %}
            <div class="notification-icon" id="notificationIcon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
                {% if unread_count and unread_count > 0 %}
                <div class="notification-badge">{{ unread_count }}</div>
                {% endif %}
            </div>
            <a href="{{ url_for('account') }}" class="user-profile-link">
                <div class="user-profile">
                    <div class="avatar">{{ user.avatar }}</div>
                    <div class="user-info">
                        <div class="username">{{ user.first_name }} {% if user.middle_name %}{{ user.middle_name }}{% endif %}</div>
                        <div class="user-role {{ user.role }}">{{ user.role_display }}</div>
                    </div>
                </div>
            </a>
        </div>
    </nav>

    <div class="chat-page">
        <a href="{{ url_for('home') }}" class="back-btn">‚Üê –ù–ê–ó–ê–î</a>
        
        <div class="chat-container">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="users-side">
                <div class="users-header">
                    <h3>–°–æ–æ–±—â–µ–Ω–∏—è</h3>
                </div>
                <div class="users-list" id="usersList">
                    {% for chat_user in chat_users %}
                    <div class="user-item" onclick="selectUser({{ chat_user.id }}, this)" 
                         data-user-id="{{ chat_user.id }}"
                         data-avatar="{{ chat_user.avatar }}"
                         data-name="{{ chat_user.last_name }} {{ chat_user.first_name }}">
                        <div class="user-avatar">{{ chat_user.avatar }}</div>
                        <div class="user-info">
                            <div class="user-name">{{ chat_user.last_name }} {{ chat_user.first_name }}</div>
                            <div class="user-username">@{{ chat_user.username }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - –æ–∫–Ω–æ —á–∞—Ç–∞ -->
            <div class="chat-side">
                <div class="chat-header" id="chatHeader" style="display: none;">
                    <div class="chat-avatar" id="chatAvatar"></div>
                    <div class="chat-header-info">
                        <h3 id="chatUserName">–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞</h3>
                        <p id="chatUserStatus">–û–Ω–ª–∞–π–Ω ‚Ä¢ –ú–æ—Å–∫–≤–∞</p>
                    </div>
                </div>
                
                <div class="messages-area" id="messagesArea">
                    <div class="empty-chat-state">
                        <h3>üí¨ –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ</h3>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ</p>
                    </div>
                </div>
                
                <div class="input-area" id="inputArea" style="display: none;">
                    <input type="hidden" id="currentReceiverId">
                    <textarea class="message-input" id="messageInput" 
                              placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                              onkeydown="checkEnter(event)"
                              oninput="adjustTextareaHeight(this)"></textarea>
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled>
                        <span id="sendBtnText">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let refreshTimer = null;
        let selectedElement = null;
        let userAvatars = {}; // –ö—ç—à –∞–≤–∞—Ç–∞—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–≤–∞—Ç–∞—Ä—ã –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        document.querySelectorAll('.user-item').forEach(item => {
            const userId = item.getAttribute('data-user-id');
            const avatar = item.getAttribute('data-avatar');
            const name = item.getAttribute('data-name');
            if (userId) {
                userAvatars[userId] = { avatar, name };
            }
        });
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—ã—Å–æ—Ç—ã textarea
        function adjustTextareaHeight(element) {
            element.style.height = 'auto';
            element.style.height = Math.min(element.scrollHeight, 120) + 'px';
            
            // –í–∫–ª—é—á–∞–µ–º/–≤—ã–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
            const btn = document.getElementById('sendBtn');
            const sendBtnText = document.getElementById('sendBtnText');
            if (btn) {
                btn.disabled = element.value.trim() === '';
            }
        }
        
        function selectUser(userId, element) {
            if (currentUser === userId) return;
            
            console.log(`–í—ã–±—Ä–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ID: ${userId}`);
            
            // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ
            if (selectedElement) {
                selectedElement.classList.remove('active');
            }
            
            // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ
            if (element) {
                element.classList.add('active');
                selectedElement = element;
            }
            
            currentUser = userId;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ —á–∞—Ç–∞
            document.getElementById('inputArea').style.display = 'flex';
            document.getElementById('chatHeader').style.display = 'flex';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
            const userInfo = userAvatars[userId];
            if (userInfo) {
                document.getElementById('chatAvatar').textContent = userInfo.avatar;
                document.getElementById('chatUserName').textContent = userInfo.name;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            loadMessages();
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
            if (refreshTimer) clearInterval(refreshTimer);
            refreshTimer = setInterval(loadMessages, 3000);
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            setTimeout(() => {
                document.getElementById('messageInput').focus();
            }, 100);
        }
        
        function loadMessages() {
            if (!currentUser) return;
            
            console.log(`–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π —Å ID: ${currentUser}`);
            
            fetch(`/chat/messages/${currentUser}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        console.log(`–ü–æ–ª—É—á–µ–Ω–æ ${data.messages.length} —Å–æ–æ–±—â–µ–Ω–∏–π`);
                        displayMessages(data.messages);
                    } else {
                        console.error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:', data.error);
                    }
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
                });
        }
        
        function displayMessages(messages) {
            const area = document.getElementById('messagesArea');
            
            if (messages.length === 0) {
                area.innerHTML = `
                    <div class="empty-chat-state">
                        <h3>üì® –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                        <p>–ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –Ω–∞—á–Ω–∏—Ç–µ –¥–∏–∞–ª–æ–≥!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            let lastDate = null;
            
            messages.forEach(msg => {
                const time = msg.created_at_formatted || '–¢–æ–ª—å–∫–æ —á—Ç–æ';
                const isMe = msg.is_me;
                const avatar = isMe ? '{{ user.avatar }}' : msg.first_name[0] + msg.last_name[0];
                const senderName = isMe ? '–í—ã' : `${msg.first_name} ${msg.last_name}`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞—Ç—É
                const msgDate = time.split(' ')[0];
                if (msgDate !== lastDate && time.includes('.')) {
                    html += `<div style="text-align: center; margin: 20px 0;">
                        <span style="background: #e2e8f0; padding: 5px 15px; border-radius: 15px; font-size: 13px; color: #64748b;">
                            ${msgDate}
                        </span>
                    </div>`;
                    lastDate = msgDate;
                }
                
                html += `
                    <div class="message-wrapper ${isMe ? 'me' : 'other'}">
                        ${!isMe ? `
                            <div class="sender-avatar" title="${senderName}">
                                ${avatar}
                            </div>
                        ` : ''}
                        
                        <div class="message-bubble">
                            <div>${msg.message}</div>
                            
                            <div class="message-status">
                                <span>${time}</span>
                                ${isMe ? '<span>‚úì‚úì</span>' : ''}
                            </div>
                        </div>
                        
                        ${isMe ? `
                            <div class="sender-avatar" title="${senderName}">
                                ${avatar}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            area.innerHTML = html;
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
            setTimeout(() => {
                area.scrollTop = area.scrollHeight;
            }, 100);
        }
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            const btn = document.getElementById('sendBtn');
            const sendBtnText = document.getElementById('sendBtnText');
            
            if (!message || !currentUser) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ');
                return;
            }
            
            btn.disabled = true;
            sendBtnText.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';
            
            const formData = new FormData();
            formData.append('receiver_id', currentUser);
            formData.append('message', message);
            
            fetch('/chat/send', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
                
                if (data.success) {
                    // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    input.value = '';
                    input.style.height = 'auto';
                    
                    // –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    const area = document.getElementById('messagesArea');
                    const currentScroll = area.scrollHeight - area.scrollTop;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–æ–∫
                    const newMsg = {
                        id: data.message_id,
                        message: message,
                        is_me: true,
                        first_name: '{{ user.first_name }}',
                        last_name: '{{ user.last_name }}',
                        created_at_formatted: data.created_at_formatted || '–¢–æ–ª—å–∫–æ —á—Ç–æ'
                    };
                    
                    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
                    loadMessages();
                    
                    // –§–æ–∫—É—Å –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
                    input.focus();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
                
                btn.disabled = false;
                sendBtnText.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
                alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.');
                btn.disabled = false;
                sendBtnText.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
            });
        }
        
        function checkEnter(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                const btn = document.getElementById('sendBtn');
                if (btn && !btn.disabled) {
                    sendMessage();
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–ß–∞—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            
            // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –≤–≤–æ–¥–µ —Ç–µ–∫—Å—Ç–∞
            const input = document.getElementById('messageInput');
            if (input) {
                input.addEventListener('input', function() {
                    const btn = document.getElementById('sendBtn');
                    if (btn) {
                        btn.disabled = this.value.trim() === '';
                    }
                });
            }
            
            // –û—á–∏—Å—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
            window.addEventListener('beforeunload', function() {
                if (refreshTimer) clearInterval(refreshTimer);
            });
        });
    </script>
</body>
</html>